<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 위치 추적 (디버그)</title>
    <link rel="stylesheet" href="/Users/sonhyeongjun/Desktop/갤러리 9:5 웹/leaflet/leaflet.css" />
    <script src="/Users/sonhyeongjun/Desktop/갤러리 9:5 웹/leaflet/leaflet.js"></script>
    <style>
        #map { height: 400px; width: 100%; border: 1px solid #ccc; }
        #info, #debug { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>실시간 위치 추적 (디버그)</h1>
    <div id="map"></div>
    <div id="info"></div>
    <div id="debug"></div>
    <script>
        let map, marker, circle;

        function checkLeaflet() {
            if (typeof L === 'undefined') {
                document.getElementById('debug').innerHTML += "Leaflet 라이브러리가 로드되지 않았습니다.<br>";
                return false;
            }
            document.getElementById('debug').innerHTML += "Leaflet 라이브러리가 성공적으로 로드되었습니다.<br>";
            return true;
        }

        function initMap() {
            if (!checkLeaflet()) return;

            try {
                map = L.map('map').setView([0, 0], 2);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);
                document.getElementById('debug').innerHTML += "지도가 성공적으로 초기화되었습니다.<br>";
            } catch (error) {
                document.getElementById('debug').innerHTML += "지도 초기화 중 오류 발생: " + error.message + "<br>";
            }
        }

        function updatePosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const accuracy = position.coords.accuracy;

            try {
                if (marker) {
                    marker.setLatLng([lat, lon]);
                    circle.setLatLng([lat, lon]);
                    circle.setRadius(accuracy);
                } else {
                    marker = L.marker([lat, lon]).addTo(map);
                    circle = L.circle([lat, lon], {radius: accuracy}).addTo(map);
                }
                map.setView([lat, lon], 15);
                document.getElementById('info').innerHTML = `
                    위도: ${lat.toFixed(6)}<br>
                    경도: ${lon.toFixed(6)}<br>
                    정확도: ${accuracy.toFixed(2)}m
                `;
                document.getElementById('debug').innerHTML += "위치가 업데이트되었습니다.<br>";
            } catch (error) {
                document.getElementById('debug').innerHTML += "위치 업데이트 중 오류 발생: " + error.message + "<br>";
            }
        }

        function handleError(error) {
            let message;
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = "위치 정보 접근 권한이 거부되었습니다.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = "위치 정보를 사용할 수 없습니다.";
                    break;
                case error.TIMEOUT:
                    message = "위치 정보 요청 시간이 초과되었습니다.";
                    break;
                case error.UNKNOWN_ERROR:
                    message = "알 수 없는 오류가 발생했습니다.";
                    break;
            }
            document.getElementById('debug').innerHTML += "오류: " + message + "<br>";
        }

        window.onload = function() {
            initMap();
            if ("geolocation" in navigator) {
                const options = {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                };
                navigator.geolocation.watchPosition(updatePosition, handleError, options);
                document.getElementById('debug').innerHTML += "위치 추적이 시작되었습니다.<br>";
            } else {
                document.getElementById('debug').innerHTML += "이 브라우저에서는 Geolocation이 지원되지 않습니다.<br>";
            }
        };
    </script>
</body>
</html>